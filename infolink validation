(function(document, $, Coral) {
    "use strict";

    // Wait for the foundation content to be loaded
    $(document).on("foundation-contentloaded", function(e) {
        // Iterate over each multifield item and apply the show/hide logic
        $(".cmp-list_editor coral-select.cq-dialog-dropdown-showhide", e.target).each(function(index, element) {
            var target = $(element).data("cq-dialog-dropdown-showhide-target");
            if (target) {
                Coral.commons.ready(element, function(component) {
                    showHide(component, target, element);
                    component.on("change", function() {
                        showHide(component, target, element);  // Ensure the show/hide logic is applied on change
                    });
                });
            }
        });

        // Apply showHide function for the initial state
        $(".cq-dialog-dropdown-showhide", e.target).each(function(index, element) {
            var target = $(element).data("cq-dialog-dropdown-showhide-target");
            if (target) {
                Coral.commons.ready(element, function(component) {
                    showHide(component, target, element);
                });
            }
        });

        // Function to show/hide elements based on the selected value
        function showHide(component, target, element) {
            var value = component.value;
            // Find the parent multifield item for this specific dropdown element
            var parentMultifield = $(element).closest(".granite-collection-item");
            var targetElement = parentMultifield.find(target);

            // Hide all target elements in the current context and then show the one that matches the selected value
            parentMultifield.find(target).addClass("hide");  // Hide all targets within the same multifield
            targetElement.filter("[data-showhidetargetvalue='" + value + "']").removeClass("hide");  // Show only the selected one
        }

        // Handle the case where the text is truncated and add a tooltip
        addTooltipIfTruncated(".line-clamp");
    });

})(document, Granite.$, Coral);
